import{_ as g,o,c as d,b as t,t as l,l as O,q as f,F as _,h as y,k,z as M,m as w,r as u,d as p,n as D}from"./index-7c11930c.js";import{u as V}from"./login-35e42891.js";import{M as E,m as L}from"./modalMixin-66c148d9.js";import{P as A}from"./PaginationComponent-2d55b482.js";const U={props:{item:{}},data(){return{modal:""}},emits:["del-item"],methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},mounted(){this.modal=new E(this.$refs.modal)}},S={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},T={class:"modal-dialog",role:"document"},I={class:"modal-content border-0"},N={class:"modal-header bg-danger text-white"},R={class:"modal-title"},B=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},j={class:"text-danger"},z={class:"modal-footer"},F=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function H(e,n,c,$,s,i){return o(),d("div",S,[t("div",T,[t("div",I,[t("div",N,[t("h5",R,[t("span",null,"刪除 訂單編號: "+l(c.item.id),1)]),B]),t("div",q,[O(" 是否刪除 "),t("strong",j,"訂單編號: "+l(c.item.id),1),O(" (刪除後將無法恢復)。 ")]),t("div",z,[F,t("button",{type:"button",class:"btn btn-danger",onClick:n[0]||(n[0]=r=>e.$emit("del-item"))},"確認刪除 ")])])])],512)}const G=g(U,[["render",H]]),J={props:{order:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",tempOrder:{},isPaid:!1}},emits:["update-paid"],mixins:[L],watch:{order(){this.tempOrder=this.order}}},K={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},Q={class:"modal-dialog modal-xl",role:"document"},W={class:"modal-content border-0"},X=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Y={class:"modal-body"},Z={class:"row"},tt={class:"col-md-4"},et=t("h3",null,"用戶資料",-1),st={class:"table"},ot={key:0},dt=t("th",{style:{width:"100px"}},"姓名",-1),lt=t("th",null,"Email",-1),nt=t("th",null,"電話",-1),at=t("th",null,"地址",-1),rt={class:"col-md-8"},it=t("h3",null,"訂單細節",-1),ct={class:"table"},ht=t("th",{style:{width:"100px"}},"訂單編號",-1),_t=t("th",null,"下單時間",-1),ut=t("th",null,"付款時間",-1),pt={key:0},mt={key:1},bt=t("th",null,"付款狀態",-1),ft={key:0,class:"text-success"},yt={key:1,class:"text-muted"},gt=t("th",null,"總金額",-1),$t=t("h3",{class:"text-dark"},"選購商品",-1),Ot={class:"table"},kt=t("thead",null,[t("tr")],-1),Mt={class:"text-end"},vt={class:"d-flex justify-content-end"},xt={class:"form-check"},Pt={class:"form-check-label text-dark",for:"flexCheckDefault"},Ct={key:0},wt={key:1},Dt={class:"modal-footer"},Vt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Et(e,n,c,$,s,i){return o(),d("div",K,[t("div",Q,[t("div",W,[X,t("div",Y,[t("div",Z,[t("div",tt,[et,t("table",st,[s.tempOrder.user?(o(),d("tbody",ot,[t("tr",null,[dt,t("td",null,l(s.tempOrder.user.name),1)]),t("tr",null,[lt,t("td",null,l(s.tempOrder.user.email),1)]),t("tr",null,[nt,t("td",null,l(s.tempOrder.user.tel),1)]),t("tr",null,[at,t("td",null,l(s.tempOrder.user.address),1)])])):f("",!0)])]),t("div",rt,[it,t("table",ct,[t("tbody",null,[t("tr",null,[ht,t("td",null,l(s.tempOrder.id),1)]),t("tr",null,[_t,t("td",null,l(e.$filters.date(s.tempOrder.create_at)),1)]),t("tr",null,[ut,t("td",null,[s.tempOrder.paid_date?(o(),d("span",pt,l(e.$filters.date(s.tempOrder.paid_date)),1)):(o(),d("span",mt,"時間不正確"))])]),t("tr",null,[bt,t("td",null,[s.tempOrder.is_paid?(o(),d("strong",ft,"已付款")):(o(),d("span",yt,"尚未付款"))])]),t("tr",null,[gt,t("td",null,l(e.$filters.currency(s.tempOrder.total)),1)])])]),$t,t("table",Ot,[kt,t("tbody",null,[(o(!0),d(_,null,y(s.tempOrder.products,r=>(o(),d("tr",{key:r.id},[t("th",null,l(r.product.title),1),t("td",null,l(r.qty)+" 張",1),t("td",Mt," $"+l(e.$filters.currency(r.final_total))+" 元 ",1)]))),128))])]),t("div",vt,[t("div",xt,[k(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=r=>s.tempOrder.is_paid=r)},null,512),[[M,s.tempOrder.is_paid]]),t("label",Pt,[s.tempOrder.is_paid?(o(),d("span",Ct,"已付款")):(o(),d("span",wt,"未付款"))])])])])])]),t("div",Dt,[Vt,t("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=r=>e.$emit("update-paid",s.tempOrder))}," 修改付款狀態 ")])])])],512)}const Lt=g(J,[["render",Et]]),{VITE_APP_URL:m,VITE_APP_PATH:b}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"brad5566",BASE_URL:"/shrimpMap/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},At={data(){return{orders:{},isNew:!1,pagination:{},tempOrder:{},currentPage:1}},components:{PaginationComponent:A,DelModal:G,OrderModal:Lt},methods:{...w(V,["checkLogin"]),getOrders(e=1){this.currentPage=e,this.$http({method:"get",url:`${m}api/${b}/admin/orders?page=${e}`}).then(n=>{this.orders=n.data.orders,this.pagination=n.data.pagination}).catch(n=>{alert(n.response)})},openModal(e){this.tempOrder={...e},this.isNew=!1,this.$refs.orderModal.openModal()},openDelOrderModal(e){this.tempOrder={...e},this.$refs.delModal.openModal()},updatePaid(e){const n={is_paid:e.is_paid};this.$http({method:"put",url:`${m}api/${b}/admin/order/${e.id}`,data:{data:n}}).then(c=>{this.$refs.orderModal.hideModal(),this.getOrders(this.currentPage)}).catch(c=>{alert(c.response)})},delOrder(){this.$http({method:"delete",url:`${m}api/${b}/admin/order/${this.tempOrder.id}`}).then(e=>{this.$refs.delModal.hideModal(),this.getOrders(this.currentPage)}).catch(e=>{console.log(e),alert(e.response)})}},mounted(){this.checkLogin(),this.getOrders()}},Ut={class:"container"},St={class:"table mt-4 text-white"},Tt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),It=["textContent"],Nt={class:"list-unstyled"},Rt={class:"text-right"},Bt={class:"form-check form-switch"},qt=["id","onUpdate:modelValue","onChange"],jt=["for"],zt={key:0},Ft={key:1},Ht={class:"btn-group"},Gt=["onClick"],Jt=["onClick"];function Kt(e,n,c,$,s,i){const r=u("OrderModal"),v=u("DelModal"),x=u("PaginationComponent");return o(),d("div",Ut,[t("table",St,[Tt,t("tbody",null,[(o(!0),d(_,null,y(s.orders,(a,P)=>(o(),d(_,{key:P},[s.orders.length?(o(),d("tr",{key:0,class:D([{"text-secondary":!a.is_paid},"text-white"])},[t("td",null,l(e.$filters.date(a.create_at)),1),t("td",null,[a.user?(o(),d("span",{key:0,textContent:l(a.user.email)},null,8,It)):f("",!0)]),t("td",null,[t("ul",Nt,[(o(!0),d(_,null,y(a.products,(h,C)=>(o(),d("li",{key:C},l(h.product.title)+" 數量："+l(h.qty)+" 張 ",1))),128))])]),t("td",Rt,l(a.total)+" 元",1),t("td",null,[t("div",Bt,[k(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":h=>a.is_paid=h,onChange:h=>i.updatePaid(a)},null,40,qt),[[M,a.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.is_paid?(o(),d("span",zt,"已付款")):(o(),d("span",Ft,"未付款"))],8,jt)])]),t("td",null,[t("div",Ht,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:h=>i.openModal(a)}," 檢視 ",8,Gt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:h=>i.openDelOrderModal(a)}," 刪除 ",8,Jt)])])],2)):f("",!0)],64))),128))])]),p(r,{order:s.tempOrder,ref:"orderModal",onUpdatePaid:i.updatePaid},null,8,["order","onUpdatePaid"]),p(v,{item:s.tempOrder,ref:"delModal",onDelItem:i.delOrder},null,8,["item","onDelItem"]),p(x,{pages:s.pagination,onEmitPages:i.getOrders},null,8,["pages","onEmitPages"])])}const Zt=g(At,[["render",Kt]]);export{Zt as default};
